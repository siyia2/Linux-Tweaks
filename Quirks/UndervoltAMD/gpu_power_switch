#!/bin/bash

PERF_FILE="/sys/class/drm/card1/device/power_dpm_force_performance_level"

# Read current state directly from GPU
CURRENT_STATE=$(cat "$PERF_FILE")

# Toggle the state
if [ "$CURRENT_STATE" = "auto" ]; then
    echo "Switching to manual low performance mode..."
    echo "manual" | sudo tee "$PERF_FILE" > /dev/null
    echo "low" | sudo tee "$PERF_FILE" > /dev/null
    echo "✓ GPU set to low power mode"
else
    echo "Switching to automatic performance mode..."
    echo "auto" | sudo tee "$PERF_FILE" > /dev/null
    echo "✓ GPU set to automatic mode"
fi

# Show current setting
CURRENT=$(cat "$PERF_FILE")
echo "Current performance level: $CURRENT"
