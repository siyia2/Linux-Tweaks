#!/bin/bash

clear

formats=(
    "tarx (tar.xz)"
    "targ (tar.gz)"
    "tarz (tar.zst)"
    "7zip (.7z)"
    "zip (.zip)"
)

echo "Choose the archive format:"

for i in "${!formats[@]}"; do
    printf "%d) %s\n" "$((i + 1))" "${formats[$i]}"
done

echo " "

read -rp "Enter your choice (1-${#formats[@]}) or any other key to exit: " choice

echo " "

if [[ "$choice" =~ ^[1-${#formats[@]}]$ ]]; then
    choice=$((choice - 1))
    type="${formats[$choice]%% (*}"
    extension=".${formats[$choice]##* (}"
else
    echo "Exiting script."
    exit 0
fi

read -rp "Enter the name for the $extension archive: " archive_name

echo " "

if [ -e "$archive_name$extension" ]; then
    echo " "
    echo "Error: File or directory $archive_name.$extension already exists."
    exit 1
fi

# Get the current working directory
cwd=$(pwd)

# Create a temporary directory in RAM
temp_dir=$(mktemp -d /dev/shm/tmp.XXXXXXXXXX)

# Copy the files to the temporary directory
cp -r "$@" "$temp_dir"

case $type in
    "tarx") tar -Jcvf "$archive_name.tar.xz" -C "$temp_dir" . ;;
    "targ") tar -czf "$archive_name.tar.gz" -C "$temp_dir" . ;;
    "tarz") env ZSTD="-6" tar --zstd -cf "$archive_name.tar.zst" -C "$temp_dir" . ;;
    "7zip") 7z a "$archive_name.7z" "$temp_dir/*" ;;
    "zip") (
            cd "$temp_dir" || exit
            zip -r "$archive_name.zip" .
            mv "$archive_name.zip" "$cwd"
        ) ;;
esac

echo " "

if [ $? -ne 0 ]; then
    echo "Compression failed!"
else
    echo "Compression successful! Archive created: $archive_name$extension"
fi

# Clean up the temporary directory
rm -rf "$temp_dir"

echo " "

read -rp "Press Enter to exit..."
